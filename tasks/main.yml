---
- name: Validate user inputs
  ansible.builtin.assert:
    that:
      - whitelisted_ip_ranges == '' or (whitelisted_ip_ranges is defined and whitelisted_ip_ranges is iterable and whitelisted_ip_ranges | length > 0)
      - whitelisted_ip_ranges == '' or (whitelisted_ip_ranges | map('ansible.utils.ipaddr') | list | select | length == whitelisted_ip_ranges | length)
    fail_msg: "Input validation failed. See README.md for information on required inputs and their format."
    success_msg: "User input configuration is valid."

- name: Verify Linux distribution version
  ansible.builtin.assert:
    that:
      - ansible_facts['distribution'] == 'Rocky'
      - ansible_facts['distribution_version'] in  ['8.10', '9.5']
    fail_msg: "Only supports RockyLinux 8.10 or 9.5. Detected: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}."
    success_msg: "Running on RockyLinux {{ ansible_facts['distribution_version'] }}."

- name: Enable the Extra Packages for Enterprise Linux repository
  ansible.builtin.dnf:
    name: epel-release
    state: present

- name: Enable DNF plugins core
  ansible.builtin.dnf:
    name: dnf-plugins-core
    state: present

- name: Enable development tools
  ansible.builtin.dnf:
    name: "@Development Tools"
    state: present

- name: Pin package versions prior to installation
  ansible.builtin.set_fact:
    package_versions:
      rockylinux_8:
        fail2ban: fail2ban-1.0.2-3.el8
        firewalld: firewalld-0.9.11-10.el8_10
        x2goserver: x2goserver-4.1.0.3-17.el8.1
        x2goserver-xsession: x2goserver-xsession-4.1.0.3-17.el8.1
        caja: caja-1.26.2-1.el8
        dconf: dconf-0.28.0-4.el8
        gtk2-engines: gtk2-engines-2.20.2-24.el8
        gvfs: gvfs-1.36.2-18.el8_10
        gvfs-afc: gvfs-afc-1.36.2-18.el8_10
        gvfs-archive: gvfs-archive-1.36.2-18.el8_10
        gvfs-fuse: gvfs-fuse-1.36.2-18.el8_10
        gvfs-gphoto2: gvfs-gphoto2-1.36.2-18.el8_10
        gvfs-mtp: gvfs-mtp-1.36.2-18.el8_10
        gvfs-smb: gvfs-smb-1.36.2-18.el8_10
        libmatekbd: libmatekbd-1.26.1-1.el8
        libmateweather: libmateweather-1.26.3-1.el8
        libsecret: libsecret-0.18.6-1.el8.0.2
        marco: marco-1.26.2-1.el8
        mate-backgrounds: mate-backgrounds-1.26.0-2.el8
        mate-control-center: mate-control-center-1.26.1-1.el8
        mate-desktop: mate-desktop-1.26.2-1.el8
        mate-desktop-libs: mate-desktop-libs-1.26.2-1.el8
        mate-icon-theme: mate-icon-theme-1.26.0-2.el8
        mate-media: mate-media-1.26.2-1.el8
        mate-menus: mate-menus-1.26.1-1.el8
        mate-notification-daemon: mate-notification-daemon-1.26.1-1.el8
        mate-panel: mate-panel-1.26.4-2.el8
        mate-polkit: mate-polkit-1.26.1-1.el8
        mate-power-manager: mate-power-manager-1.26.1-1.el8
        mate-session-manager: mate-session-manager-1.26.1-1.el8
        mate-settings-daemon: mate-settings-daemon-1.26.1-1.el8
        mate-system-monitor: mate-system-monitor-1.26.2-1.el8
        mate-themes: mate-themes-3.22.24-1.el8
        xdg-user-dirs-gtk: xdg-user-dirs-gtk-0.10-13.el8
        yelp: yelp-3.28.1-3.el8_10.1
        NetworkManager: NetworkManager-1.40.16-18.el8_10
        NetworkManager-l2tp: NetworkManager-l2tp-1.20.20-1.el8
        NetworkManager-openconnect: NetworkManager-openconnect-1.2.6-2.el8.1
        NetworkManager-openvpn: NetworkManager-openvpn-1.8.10-1.el8.1
        NetworkManager-pptp: NetworkManager-pptp-1.2.8-1.el8.3
        brasero: brasero-3.12.2-5.el8
        caja-image-converter: caja-image-converter-1.26.1-3.el8
        caja-open-terminal: caja-open-terminal-1.26.1-3.el8
        caja-sendto: caja-sendto-1.26.1-3.el8
        dconf-editor: dconf-editor-3.28.0-1.el8
        engrampa: engrampa-1.26.2-1.el8
        eom: eom-1.26.1-1.el8
        filezilla: filezilla-3.55.1-1.el8
        firefox: firefox-128.11.0-1.el8_10
        firewall-config: firewall-config-0.9.11-10.el8_10
        gparted: gparted-1.3.1-1.el8
        gucharmap: gucharmap-12.0.1-1.el8
        lightdm: lightdm-1.30.0-19.el8
        lightdm-gtk: lightdm-gtk-2.0.8-4.el8
        mate-applets: mate-applets-1.26.1-1.el8
        mate-calc: mate-calc-1.24.2-3.el8
        mate-dictionary: mate-dictionary-1.26.1-1.el8
        mate-disk-usage-analyzer: mate-disk-usage-analyzer-1.26.1-1.el8
        mate-menus-preferences-category-menu: mate-menus-preferences-category-menu-1.26.1-1.el8
        mate-screensaver: mate-screensaver-1.26.2-1.el8
        mate-screenshot: mate-screenshot-1.26.1-1.el8
        mate-search-tool: mate-search-tool-1.26.1-1.el8
        mate-system-log: mate-system-log-1.26.1-1.el8
        mate-terminal: mate-terminal-1.26.1-1.el8
        mozo: mozo-1.26.2-2.el8
        network-manager-applet: network-manager-applet-1.26.0-1.el8
        p7zip: p7zip-16.02-31.el8
        p7zip-plugins: p7zip-plugins-16.02-31.el8
        pluma: pluma-1.26.1-1.el8
        seahorse: seahorse-3.20.0-9.el8
        setroubleshoot: setroubleshoot-3.3.26-6.el8
        simple-scan: simple-scan-3.36.2.1-1.el8
        totem: totem-3.26.2-1.el8
        transmission-gtk: transmission-gtk-3.00-1.el8
        vim-enhanced: vim-enhanced-8.0.1763-19.el8_6.4
        rhythmbox: rhythmbox-3.4.2-8.el8
        caja-actions: caja-actions-1.26.0-2.el8
        caja-beesu: caja-beesu-1.26.1-3.el8
        firewall-applet: firewall-applet-0.9.11-10.el8_10
        mate-sensors-applet: mate-sensors-applet-1.26.0-1.el8
        mate-utils: mate-utils-1.26.1-1.el8
        libreoffice: libreoffice-6.4.7.2-19.el8_10
      rockylinux_9:
        fail2ban: fail2ban-1.1.0-6.el9
        firewalld: firewalld-1.3.4-9.el9_5
        x2goserver: x2goserver-4.1.0.3-17.el9
        x2goserver-xsession: x2goserver-xsession-4.1.0.3-17.el9
        caja: caja-1.26.3-1.el9
        dconf: dconf-0.40.0-6.el9
        gtk2-engines: gtk2-engines-2.20.2-24.el9
        gvfs: gvfs-1.48.1-6.el9
        gvfs-fuse: gvfs-fuse-1.48.1-6.el9
        gvfs-gphoto2: gvfs-gphoto2-1.48.1-6.el9
        gvfs-mtp: gvfs-mtp-1.48.1-6.el9
        gvfs-smb: gvfs-smb-1.48.1-6.el9
        libmatekbd: libmatekbd-1.26.1-1.el9
        libmateweather: libmateweather-1.26.3-1.el9
        libsecret: libsecret-0.20.4-4.el9
        marco: marco-1.26.2-1.el9
        mate-backgrounds: mate-backgrounds-1.26.0-2.el9
        mate-control-center: mate-control-center-1.26.1-1.el9
        mate-desktop: mate-desktop-1.26.2-1.el9
        mate-desktop-libs: mate-desktop-libs-1.26.2-1.el9
        mate-icon-theme: mate-icon-theme-1.26.0-2.el9
        mate-media: mate-media-1.26.2-1.el9
        mate-menus: mate-menus-1.26.1-1.el9
        mate-notification-daemon: mate-notification-daemon-1.26.1-1.el9
        mate-panel: mate-panel-1.26.4-1.el9
        mate-polkit: mate-polkit-1.26.1-1.el9
        mate-power-manager: mate-power-manager-1.26.1-1.el9
        mate-session-manager: mate-session-manager-1.26.1-1.el9
        mate-settings-daemon: mate-settings-daemon-1.26.1-1.el9
        mate-system-monitor: mate-system-monitor-1.26.2-1.el9
        mate-themes: mate-themes-3.22.24-1.el9
        xdg-user-dirs-gtk: xdg-user-dirs-gtk-0.10-22.el9
        yelp: yelp-40.3-2.el9_6.1
        NetworkManager: NetworkManager-1.48.10-8.el9_5
        NetworkManager-l2tp: NetworkManager-l2tp-1.20.20-1.el9
        NetworkManager-openconnect: NetworkManager-openconnect-1.2.6-9.el9
        NetworkManager-openvpn: NetworkManager-openvpn-1.12.0-2.el9
        NetworkManager-pptp: NetworkManager-pptp-1.2.8-5.el9
        brasero: brasero-3.12.2-19.el9
        caja-image-converter: caja-image-converter-1.26.1-3.el9
        caja-open-terminal: caja-open-terminal-1.26.1-3.el9
        caja-sendto: caja-sendto-1.26.1-3.el9
        dconf-editor: dconf-editor-3.38.3-3.el9
        engrampa: engrampa-1.26.2-1.el9
        eom: eom-1.26.1-1.el9
        filezilla: filezilla-3.60.1-1.el9
        firefox: firefox-128.13.0-1.el9_6
        firewall-config: firewall-config-1.3.4-9.el9_5
        gparted: gparted-1.4.0-1.el9
        gucharmap: gucharmap-13.0.8-1.el9
        lightdm: lightdm-1.30.0-19.el9
        lightdm-gtk: lightdm-gtk-2.0.8-4.el9
        mate-applets: mate-applets-1.26.1-3.el9
        mate-calc: mate-calc-1.26.0-2.el9
        mate-dictionary: mate-dictionary-1.26.1-1.el9
        mate-disk-usage-analyzer: mate-disk-usage-analyzer-1.26.1-1.el9
        mate-menus-preferences-category-menu: mate-menus-preferences-category-menu-1.26.1-1.el9
        mate-screensaver: mate-screensaver-1.26.2-1.el9
        mate-screenshot: mate-screenshot-1.26.1-1.el9
        mate-search-tool: mate-search-tool-1.26.1-1.el9
        mate-system-log: mate-system-log-1.26.1-1.el9
        mate-terminal: mate-terminal-1.26.1-1.el9
        mozo: mozo-1.26.2-1.el9
        network-manager-applet: network-manager-applet-1.26.0-2.el9
        p7zip: p7zip-16.02-31.el9
        p7zip-plugins: p7zip-plugins-16.02-31.el9
        pluma: pluma-1.26.1-1.el9
        seahorse: seahorse-40.0-2.el9
        setroubleshoot: setroubleshoot-3.3.32-1.el9
        simple-scan: simple-scan-40.7-1.el9
        totem: totem-3.38.2-2.el9
        transmission-gtk: transmission-gtk-4.0.5-1.1.el9
        vim-enhanced: vim-enhanced-8.2.2637-21.el9
        caja-actions: caja-actions-1.26.0-3.el9
        caja-beesu: caja-beesu-1.26.1-3.el9
        firewall-applet: firewall-applet-1.3.4-9.el9_5
        mate-sensors-applet: mate-sensors-applet-1.26.0-2.el9
        mate-utils: mate-utils-1.26.1-1.el9
        libreoffice: libreoffice-7.1.8.1-15.el9_5

- name: Install security packages
  ansible.builtin.dnf:
    name:
      - "{{ item }}"
    state: present
    allow_downgrade: true
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['fail2ban'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['firewalld'] }}"

- name: Set dnf package repositories to enable according to distribution version
  ansible.builtin.set_fact:
    dnf_repos: "{{ 'epel,crb' if ansible_facts['distribution_version'] == '9.5' else 'epel,powertools' }}"

- name: Install X2Go server packages
  ansible.builtin.dnf:
    name:
      - "{{ item }}"
    enablerepo: "{{ dnf_repos }}"
    state: present
    allow_downgrade: true
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['x2goserver'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['x2goserver-xsession'] }}"

- name: Install MATE desktop packages (Core)
  ansible.builtin.dnf:
    name: "{{ item }}"
    enablerepo: "{{ dnf_repos }}"
    state: present
    allow_downgrade: true
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['dconf'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gtk2-engines'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-fuse'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-gphoto2'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-mtp'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-smb'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['libmatekbd'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['libmateweather'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['libsecret'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['marco'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-backgrounds'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-control-center'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-desktop'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-desktop-libs'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-icon-theme'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-media'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-menus'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-notification-daemon'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-panel'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-polkit'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-power-manager'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-session-manager'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-settings-daemon'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-system-monitor'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-themes'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['xdg-user-dirs-gtk'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['yelp'] }}"

- name: Install MATE desktop packages (Core, legacy) on RockyLinux 8.10
  ansible.builtin.dnf:
    name: "{{ item }}"
    state: present
    enablerepo: "{{ dnf_repos }}"
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-afc'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gvfs-archive'] }}"
  when:
    - ansible_facts['distribution_version'] == '8.10'

- name: Install MATE desktop packages (Default)
  ansible.builtin.dnf:
    name: "{{ item }}"
    enablerepo: "{{ dnf_repos }}"
    state: present
    allow_downgrade: true
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['NetworkManager'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['NetworkManager-l2tp'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['NetworkManager-openconnect'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['NetworkManager-openvpn'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['NetworkManager-pptp'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['brasero'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja-image-converter'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja-open-terminal'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja-sendto'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['dconf-editor'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['engrampa'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['eom'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['filezilla'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['firefox'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['firewall-config'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gparted'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['gucharmap'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['lightdm'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['lightdm-gtk'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-applets'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-calc'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-dictionary'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-disk-usage-analyzer'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-menus-preferences-category-menu'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-screensaver'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-screenshot'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-search-tool'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-system-log'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-terminal'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mozo'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['network-manager-applet'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['p7zip'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['p7zip-plugins'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['pluma'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['seahorse'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['setroubleshoot'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['simple-scan'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['totem'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['transmission-gtk'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['vim-enhanced'] }}"

- name: Install MATE desktop packages (Default, legacy) on RockyLinux 8.10
  ansible.builtin.dnf:
    name: "{{ item }}"
    state: present
    enablerepo: "{{ dnf_repos }}"
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['rhythmbox'] }}"
  when:
    - ansible_facts['distribution_version'] == '8.10'

- name: Install MATE desktop packages (Optional)
  ansible.builtin.dnf:
    name: "{{ item }}"
    enablerepo: "{{ dnf_repos }}"
    state: present
    allow_downgrade: true
  loop:
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja-actions'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['caja-beesu'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['firewall-applet'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-sensors-applet'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['mate-utils'] }}"
    - "{{ package_versions['rockylinux_' + ansible_facts['distribution_major_version']]['libreoffice'] }}"

- name: SSH - Disallow root SSH access
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: "^PermitRootLogin"
    line: "PermitRootLogin no"
    state: present
  notify: Restart sshd

- name: SSH - Enable Password Authentication
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: "^PasswordAuthentication"
    line: "PasswordAuthentication yes"
    state: present

- name: Configure /etc/fail2ban/jail.d/ssh.conf
  ansible.builtin.template:
    src: ssh.conf.j2
    dest: /etc/fail2ban/jail.d/ssh.conf
    mode: '0644'
    owner: root
    group: root
  notify: Restart fail2ban

- name: Firewalld - Enabled and restarted
  ansible.builtin.service:
    name: firewalld
    state: started
    enabled: true

- name: Fail2ban - Enabled and restarted
  ansible.builtin.service:
    name: fail2ban
    state: started
    enabled: true

- name: X2gocleansessions - Enabled and started
  ansible.builtin.service:
    name: x2gocleansessions
    state: started
    enabled: true

- name: Gather package facts
  ansible.builtin.package_facts:
    manager: auto

- name: List installed package versions
  ansible.builtin.debug:
    msg:
      - "x2goserver: {{ ansible_facts.packages['x2goserver'][0].version }}-{{ ansible_facts.packages['x2goserver'][0].release }}"
      - "x2goserver-xsession: {{ ansible_facts.packages['x2goserver-xsession'][0].version }}-{{ ansible_facts.packages['x2goserver-xsession'][0].release }}"
      - "caja: {{ ansible_facts.packages['caja'][0].version }}-{{ ansible_facts.packages['caja'][0].release }}"
      - "dconf: {{ ansible_facts.packages['dconf'][0].version }}-{{ ansible_facts.packages['dconf'][0].release }}"
      - "gtk2-engines: {{ ansible_facts.packages['gtk2-engines'][0].version }}-{{ ansible_facts.packages['gtk2-engines'][0].release }}"
      - "gvfs: {{ ansible_facts.packages['gvfs'][0].version }}-{{ ansible_facts.packages['gvfs'][0].release }}"
      - "gvfs-fuse: {{ ansible_facts.packages['gvfs-fuse'][0].version }}-{{ ansible_facts.packages['gvfs-fuse'][0].release }}"
      - "gvfs-gphoto2: {{ ansible_facts.packages['gvfs-gphoto2'][0].version }}-{{ ansible_facts.packages['gvfs-gphoto2'][0].release }}"
      - "gvfs-mtp: {{ ansible_facts.packages['gvfs-mtp'][0].version }}-{{ ansible_facts.packages['gvfs-mtp'][0].release }}"
      - "gvfs-smb: {{ ansible_facts.packages['gvfs-smb'][0].version }}-{{ ansible_facts.packages['gvfs-smb'][0].release }}"
      - "libmatekbd: {{ ansible_facts.packages['libmatekbd'][0].version }}-{{ ansible_facts.packages['libmatekbd'][0].release }}"
      - "libmateweather: {{ ansible_facts.packages['libmateweather'][0].version }}-{{ ansible_facts.packages['libmateweather'][0].release }}"
      - "libsecret: {{ ansible_facts.packages['libsecret'][0].version }}-{{ ansible_facts.packages['libsecret'][0].release }}"
      - "marco: {{ ansible_facts.packages['marco'][0].version }}-{{ ansible_facts.packages['marco'][0].release }}"
      - "mate-backgrounds: {{ ansible_facts.packages['mate-backgrounds'][0].version }}-{{ ansible_facts.packages['mate-backgrounds'][0].release }}"
      - "mate-control-center: {{ ansible_facts.packages['mate-control-center'][0].version }}-{{ ansible_facts.packages['mate-control-center'][0].release }}"
      - "mate-desktop: {{ ansible_facts.packages['mate-desktop'][0].version }}-{{ ansible_facts.packages['mate-desktop'][0].release }}"
      - "mate-desktop-libs: {{ ansible_facts.packages['mate-desktop-libs'][0].version }}-{{ ansible_facts.packages['mate-desktop-libs'][0].release }}"
      - "mate-icon-theme: {{ ansible_facts.packages['mate-icon-theme'][0].version }}-{{ ansible_facts.packages['mate-icon-theme'][0].release }}"
      - "mate-media: {{ ansible_facts.packages['mate-media'][0].version }}-{{ ansible_facts.packages['mate-media'][0].release }}"
      - "mate-menus: {{ ansible_facts.packages['mate-menus'][0].version }}-{{ ansible_facts.packages['mate-menus'][0].release }}"
      - "mate-notification-daemon: {{ ansible_facts.packages['mate-notification-daemon'][0].version }}-{{ ansible_facts.packages['mate-notification-daemon'][0].release }}"
      - "mate-panel: {{ ansible_facts.packages['mate-panel'][0].version }}-{{ ansible_facts.packages['mate-panel'][0].release }}"
      - "mate-polkit: {{ ansible_facts.packages['mate-polkit'][0].version }}-{{ ansible_facts.packages['mate-polkit'][0].release }}"
      - "mate-power-manager: {{ ansible_facts.packages['mate-power-manager'][0].version }}-{{ ansible_facts.packages['mate-power-manager'][0].release }}"
      - "mate-session-manager: {{ ansible_facts.packages['mate-session-manager'][0].version }}-{{ ansible_facts.packages['mate-session-manager'][0].release }}"
      - "mate-settings-daemon: {{ ansible_facts.packages['mate-settings-daemon'][0].version }}-{{ ansible_facts.packages['mate-settings-daemon'][0].release }}"
      - "mate-system-monitor: {{ ansible_facts.packages['mate-system-monitor'][0].version }}-{{ ansible_facts.packages['mate-system-monitor'][0].release }}"
      - "mate-themes: {{ ansible_facts.packages['mate-themes'][0].version }}-{{ ansible_facts.packages['mate-themes'][0].release }}"
      - "xdg-user-dirs-gtk: {{ ansible_facts.packages['xdg-user-dirs-gtk'][0].version }}-{{ ansible_facts.packages['xdg-user-dirs-gtk'][0].release }}"
      - "yelp: {{ ansible_facts.packages['yelp'][0].version }}-{{ ansible_facts.packages['yelp'][0].release }}"
      - "NetworkManager: {{ ansible_facts.packages['NetworkManager'][0].version }}-{{ ansible_facts.packages['NetworkManager'][0].release }}"
      - "NetworkManager-l2tp: {{ ansible_facts.packages['NetworkManager-l2tp'][0].version }}-{{ ansible_facts.packages['NetworkManager-l2tp'][0].release }}"
      - "NetworkManager-openconnect: {{ ansible_facts.packages['NetworkManager-openconnect'][0].version }}-{{ ansible_facts.packages['NetworkManager-openconnect'][0].release }}"
      - "NetworkManager-openvpn: {{ ansible_facts.packages['NetworkManager-openvpn'][0].version }}-{{ ansible_facts.packages['NetworkManager-openvpn'][0].release }}"
      - "NetworkManager-pptp: {{ ansible_facts.packages['NetworkManager-pptp'][0].version }}-{{ ansible_facts.packages['NetworkManager-pptp'][0].release }}"
      - "brasero: {{ ansible_facts.packages['brasero'][0].version }}-{{ ansible_facts.packages['brasero'][0].release }}"
      - "caja-image-converter: {{ ansible_facts.packages['caja-image-converter'][0].version }}-{{ ansible_facts.packages['caja-image-converter'][0].release }}"
      - "caja-open-terminal: {{ ansible_facts.packages['caja-open-terminal'][0].version }}-{{ ansible_facts.packages['caja-open-terminal'][0].release }}"
      - "caja-sendto: {{ ansible_facts.packages['caja-sendto'][0].version }}-{{ ansible_facts.packages['caja-sendto'][0].release }}"
      - "dconf-editor: {{ ansible_facts.packages['dconf-editor'][0].version }}-{{ ansible_facts.packages['dconf-editor'][0].release }}"
      - "engrampa: {{ ansible_facts.packages['engrampa'][0].version }}-{{ ansible_facts.packages['engrampa'][0].release }}"
      - "eom: {{ ansible_facts.packages['eom'][0].version }}-{{ ansible_facts.packages['eom'][0].release }}"
      - "filezilla: {{ ansible_facts.packages['filezilla'][0].version }}-{{ ansible_facts.packages['filezilla'][0].release }}"
      - "firefox: {{ ansible_facts.packages['firefox'][0].version }}-{{ ansible_facts.packages['firefox'][0].release }}"
      - "firewall-config: {{ ansible_facts.packages['firewall-config'][0].version }}-{{ ansible_facts.packages['firewall-config'][0].release }}"
      - "gparted: {{ ansible_facts.packages['gparted'][0].version }}-{{ ansible_facts.packages['gparted'][0].release }}"
      - "gucharmap: {{ ansible_facts.packages['gucharmap'][0].version }}-{{ ansible_facts.packages['gucharmap'][0].release }}"
      - "lightdm: {{ ansible_facts.packages['lightdm'][0].version }}-{{ ansible_facts.packages['lightdm'][0].release }}"
      - "lightdm-gtk: {{ ansible_facts.packages['lightdm-gtk'][0].version }}-{{ ansible_facts.packages['lightdm-gtk'][0].release }}"
      - "mate-applets: {{ ansible_facts.packages['mate-applets'][0].version }}-{{ ansible_facts.packages['mate-applets'][0].release }}"
      - "mate-calc: {{ ansible_facts.packages['mate-calc'][0].version }}-{{ ansible_facts.packages['mate-calc'][0].release }}"
      - "mate-dictionary: {{ ansible_facts.packages['mate-dictionary'][0].version }}-{{ ansible_facts.packages['mate-dictionary'][0].release }}"
      - "mate-disk-usage-analyzer: {{ ansible_facts.packages['mate-disk-usage-analyzer'][0].version }}-{{ ansible_facts.packages['mate-disk-usage-analyzer'][0].release }}"
      - "mate-menus-preferences-category-menu: {{ ansible_facts.packages['mate-menus-preferences-category-menu'][0].version }}-{{ ansible_facts.packages['mate-menus-preferences-category-menu'][0].release }}"
      - "mate-screensaver: {{ ansible_facts.packages['mate-screensaver'][0].version }}-{{ ansible_facts.packages['mate-screensaver'][0].release }}"
      - "mate-screenshot: {{ ansible_facts.packages['mate-screenshot'][0].version }}-{{ ansible_facts.packages['mate-screenshot'][0].release }}"
      - "mate-search-tool: {{ ansible_facts.packages['mate-search-tool'][0].version }}-{{ ansible_facts.packages['mate-search-tool'][0].release }}"
      - "mate-system-log: {{ ansible_facts.packages['mate-system-log'][0].version }}-{{ ansible_facts.packages['mate-system-log'][0].release }}"
      - "mate-terminal: {{ ansible_facts.packages['mate-terminal'][0].version }}-{{ ansible_facts.packages['mate-terminal'][0].release }}"
      - "mozo: {{ ansible_facts.packages['mozo'][0].version }}-{{ ansible_facts.packages['mozo'][0].release }}"
      - "network-manager-applet: {{ ansible_facts.packages['network-manager-applet'][0].version }}-{{ ansible_facts.packages['network-manager-applet'][0].release }}"
      - "p7zip: {{ ansible_facts.packages['p7zip'][0].version }}-{{ ansible_facts.packages['p7zip'][0].release }}"
      - "p7zip-plugins: {{ ansible_facts.packages['p7zip-plugins'][0].version }}-{{ ansible_facts.packages['p7zip-plugins'][0].release }}"
      - "pluma: {{ ansible_facts.packages['pluma'][0].version }}-{{ ansible_facts.packages['pluma'][0].release }}"
      - "seahorse: {{ ansible_facts.packages['seahorse'][0].version }}-{{ ansible_facts.packages['seahorse'][0].release }}"
      - "setroubleshoot: {{ ansible_facts.packages['setroubleshoot'][0].version }}-{{ ansible_facts.packages['setroubleshoot'][0].release }}"
      - "simple-scan: {{ ansible_facts.packages['simple-scan'][0].version }}-{{ ansible_facts.packages['simple-scan'][0].release }}"
      - "totem: {{ ansible_facts.packages['totem'][0].version }}-{{ ansible_facts.packages['totem'][0].release }}"
      - "transmission-gtk: {{ ansible_facts.packages['transmission-gtk'][0].version }}-{{ ansible_facts.packages['transmission-gtk'][0].release }}"
      - "vim-enhanced: {{ ansible_facts.packages['vim-enhanced'][0].version }}-{{ ansible_facts.packages['vim-enhanced'][0].release }}"
      - "caja-actions: {{ ansible_facts.packages['caja-actions'][0].version }}-{{ ansible_facts.packages['caja-actions'][0].release }}"
      - "caja-beesu: {{ ansible_facts.packages['caja-beesu'][0].version }}-{{ ansible_facts.packages['caja-beesu'][0].release }}"
      - "firewall-applet: {{ ansible_facts.packages['firewall-applet'][0].version }}-{{ ansible_facts.packages['firewall-applet'][0].release }}"
      - "mate-sensors-applet: {{ ansible_facts.packages['mate-sensors-applet'][0].version }}-{{ ansible_facts.packages['mate-sensors-applet'][0].release }}"
      - "mate-utils: {{ ansible_facts.packages['mate-utils'][0].version }}-{{ ansible_facts.packages['mate-utils'][0].release }}"
      - "libreoffice: {{ ansible_facts.packages['libreoffice'][0].version }}-{{ ansible_facts.packages['libreoffice'][0].release }}"
      - "firewalld: {{ ansible_facts.packages['firewalld'][0].version }}-{{ ansible_facts.packages['firewalld'][0].release }}"
      - "fail2ban: {{ ansible_facts.packages['fail2ban'][0].version }}-{{ ansible_facts.packages['fail2ban'][0].release }}"
      - "gvfs-afc: {{ 'N/A' if (ansible_facts['distribution_version'] == '9.5') else ansible_facts.packages['gvfs-afc'][0].version + '-' + ansible_facts.packages['gvfs-afc'][0].release }}"
      - "gvfs-archive: {{ 'N/A' if (ansible_facts['distribution_version'] == '9.5') else ansible_facts.packages['gvfs-archive'][0].version + '-' + ansible_facts.packages['gvfs-archive'][0].release }}"
      - "rhythmbox: {{ 'N/A' if (ansible_facts['distribution_version'] == '9.5') else ansible_facts.packages['rhythmbox'][0].version + '-' + ansible_facts.packages['rhythmbox'][0].release }}"
